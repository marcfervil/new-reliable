<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Reliable</title>
        <style>
            img {
                -webkit-user-drag: none;
                -khtml-user-drag: none;
                -moz-user-drag: none;
                -o-user-drag: none;
            }
            g{
                z-index: 20;
            }
        </style>
    </head>
    <body>
          <!-- <path d="M 50 50 c 25 50, 75 -50, 100 0" fill="transparent" stroke="black"/>-->
        <h1>New Reliable: <i id="toolName" style="size:10">Pen<i/></h1>
        <svg style="position: absolute; top:0px; left:0px; width:100%; height:100%; z-index: -1" id="canvas"> </svg>
       
        <!--img id="image" style="position:absolute;" src="https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif" width="300" /-->
        <div style = "position: fixed; z-index: 10;">
 
            <button onClick="clearAll()">Clear</button>
            <button onClick="refresh()">Refresh</button>
            <button onClick="undo()">Undo</button>
        </div>
      
    </body>
</html>


<script src="{{path}}/jquery.js" type="text/javascript"></script>
<script src="{{path}}/Vector2.js" type="text/javascript"></script>
<script src="{{path}}/action.js" type="text/javascript"></script>
<script src="{{path}}/Svg/svg.js" type="text/javascript"></script>
<script src="{{path}}/Svg/svgPath.js" type="text/javascript"></script>
<script src="{{path}}/Svg/svgPointer.js" type="text/javascript"></script>
<script src="{{path}}/tools.js" type="text/javascript"></script>
<script src="{{path}}/reliable.js" type="text/javascript"></script>
<script src="{{path}}/Tools/pen.js" type="text/javascript"></script>
<script src="{{path}}/Tools/shape.js" type="text/javascript"></script>
<script src="{{path}}/Tools/selection.js" type="text/javascript"></script>
<script src="{{path}}/Tools/text.js" type="text/javascript"></script>
<script src="{{path}}/Tools/erase.js" type="text/javascript"></script>
<script src="{{path}}/Tools/image.js" type="text/javascript"></script>
<script src="{{path}}/Tools/pan.js" type="text/javascript"></script>

<script type="text/javascript">

    var isVsCode = !(typeof acquireVsCodeApi === 'undefined');
    var vscode = acquireVsCodeApi();
    var canvas = $("#canvas")[0];

    var app = new Reliable(canvas, [
        new Pen(),
        new Selection(),
        //new Eraser()
    ]);

    //app.commit({"action":"Draw","id":"4NAZsgCucv","path":"M 249.0 155.0C 249.0 155.0 248.0 154.0 248.0 155.0 247.0 156.0 246.0 157.0 243.0 159.0 243.0 161.0 241.0 163.0 240.0 164.0 240.0 165.0 240.0 167.0 239.0 168.0 239.0 170.0 239.0 171.0 239.0 173.0 239.0 175.0 239.0 177.0 239.0 179.0 240.0 181.0 241.0 184.0 244.0 188.0 247.0 192.0 249.0 196.0 253.0 201.0 256.0 206.0 259.0 211.0 263.0 216.0 266.0 221.0 269.0 226.0 272.0 231.0 274.0 236.0 276.0 240.0 276.0 243.0 278.0 248.0 278.0 250.0 278.0 253.0 278.0 256.0 278.0 259.0 278.0 263.0 277.0 265.0 273.0 269.0 268.0 273.0 261.0 277.0 253.0 281.0 244.0 285.0 238.0 286.0 229.0 289.0 219.0 290.0 210.0 291.0 203.0 292.0 196.0 292.0 185.0 291.0 181.0 289.0 176.0 286.0","color":"#AAB2C0","pos":{"x":249,"y":155}},false);
    //app.commit({"action":"Select","ids":["4NAZsgCucv"]}, false);

    function undo(){
        app.undo();
    }

    function refresh(){
        console.clear();
        vscode.postMessage({
            action: "Refresh"
        });
    }

    function clearAll(){
        $(canvas).empty();
    }

    $("#toolName").text(app.getCurrentTool().name);
    //Events:

    //keypress events
    document.addEventListener('keydown', function(event) {
        if ((event.ctrlKey && event.key === 'z') || (event.metaKey && event.key === 'z')) {
            undo();
        }
        if(event.key === "p")app.currentTool ++;
        if(event.key === "o")app.currentTool --;
        if(app.currentTool==app.toolbar.length)app.currentTool=0;
        if(app.currentTool<0)app.currentTool=app.toolbar.length-1;
        $("#toolName").text(app.getCurrentTool().name);
    });

    //recieve message from VSCode
    window.addEventListener('message', (message) => {
        app.commit(message.data, false);
    });

    //Paste Image 
    document.onpaste = function(pasteEvent) {
        var item = pasteEvent.clipboardData.items[0];

        if (item.type.indexOf("image") === 0) {
            var blob = item.getAsFile();

            var reader = new FileReader();
            reader.onload = function(event) {
                //let img = new ImageSVG("path", new Vector2(), event.target.result);
                //svgs.push(img);
            };
            reader.readAsDataURL(blob);
        }
    }


    



</script>