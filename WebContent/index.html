<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Reliable</title>
        <style>
            img {
                -webkit-user-drag: none;
                -khtml-user-drag: none;
                -moz-user-drag: none;
                -o-user-drag: none;
            }
        </style>
    </head>
    <body>
          <!-- <path d="M 50 50 c 25 50, 75 -50, 100 0" fill="transparent" stroke="black"/>-->
        
        <svg style="position: absolute; top:0px; left:0px; width:100%; height:100%; z-index: -1" id="canvas"> </svg>
      
        <!--img id="image" style="position:absolute;" src="https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif" width="300" /-->
        <div style = "position: fixed; z-index: 10;">
 
            <button onClick="clearAll()">Clear</button>
            <button onClick="refresh()">Refresh</button>
            <button onClick="undo()">Undo</button>
        </div>
      
    </body>
</html>


<script src="{{path}}/jquery.js" type="text/javascript"></script>
<script src="{{path}}/Vector2.js" type="text/javascript"></script>
<script src="{{path}}/action.js" type="text/javascript"></script>
<script src="{{path}}/Svg/svg.js" type="text/javascript"></script>
<script src="{{path}}/Svg/svgPath.js" type="text/javascript"></script>
<script src="{{path}}/tools.js" type="text/javascript"></script>
<script src="{{path}}/reliable.js" type="text/javascript"></script>
<script src="{{path}}/Tools/pen.js" type="text/javascript"></script>
<script src="{{path}}/Tools/shape.js" type="text/javascript"></script>
<script src="{{path}}/Tools/selection.js" type="text/javascript"></script>
<script src="{{path}}/Tools/text.js" type="text/javascript"></script>
<script src="{{path}}/Tools/erase.js" type="text/javascript"></script>
<script src="{{path}}/Tools/image.js" type="text/javascript"></script>
<script src="{{path}}/Tools/pan.js" type="text/javascript"></script>

<script type="text/javascript">

    var isVsCode = !(typeof acquireVsCodeApi === 'undefined');
    var vscode = acquireVsCodeApi();
    var canvas = $("#canvas")[0];

    var app = new Reliable(canvas, [
        new Pen(),
        new RedPen()
    ]);

    function undo(){
        app.undo();
    }

    function refresh(){
        console.clear();
        vscode.postMessage({
            action: "Refresh"
        });
    }

    function clearAll(){
        $(canvas).empty();
    }

    //Events:

    //keypress events
    document.addEventListener('keydown', function(event) {
        if ((event.ctrlKey && event.key === 'z') || (event.metaKey && event.key === 'z')) {
            undo();
        }
        if(event.key === "p")app.currentTool ++;
        if(event.key === "o")app.currentTool --;
    });

    //recieve message from VSCode
    window.addEventListener('message', (message) => {
        app.commit(message.data, false);
    });

    //Paste Image 
    document.onpaste = function(pasteEvent) {
        var item = pasteEvent.clipboardData.items[0];

        if (item.type.indexOf("image") === 0) {
            var blob = item.getAsFile();

            var reader = new FileReader();
            reader.onload = function(event) {
                //let img = new ImageSVG("path", new Vector2(), event.target.result);
                //svgs.push(img);
            };
            reader.readAsDataURL(blob);
        }
    }


    



</script>