<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Reliable</title>
        <style>
            img {
                -webkit-user-drag: none;
                -khtml-user-drag: none;
                -moz-user-drag: none;
                -o-user-drag: none;
            }
            g{
                z-index: 20;
            }
        </style>
    </head>
    <body>
          <!-- <path d="M 50 50 c 25 50, 75 -50, 100 0" fill="transparent" stroke="black"/>-->
        <h1>New Reliable: <i id="toolName" style="size:10">Pen<i/></h1>
        <svg style="position: absolute; top:0px; left:0px; width:100%; height:100%; z-index: -1" id="canvas"> </svg>
       
        <!--img id="image" style="position:absolute;" src="https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif" width="300" /-->
        <div style = "position: fixed; z-index: 10;">
 
            <button onClick="clearAll()">Clear</button>
            <button onClick="refresh()">Refresh</button>
            <button onClick="undo()">Undo</button>
        </div>
      
    </body>
</html>


<script src="{{path}}/jquery.js" type="text/javascript"></script>
<script src="{{path}}/Vector2.js" type="text/javascript"></script>
<script src="{{path}}/action.js" type="text/javascript"></script>
<script src="{{path}}/Svg/svg.js" type="text/javascript"></script>
<script src="{{path}}/Svg/svgPath.js" type="text/javascript"></script>
<script src="{{path}}/Svg/svgPointer.js" type="text/javascript"></script>
<script src="{{path}}/tools.js" type="text/javascript"></script>
<script src="{{path}}/reliable.js" type="text/javascript"></script>
<script src="{{path}}/Tools/pen.js" type="text/javascript"></script>
<script src="{{path}}/Tools/shape.js" type="text/javascript"></script>
<script src="{{path}}/Tools/selection.js" type="text/javascript"></script>
<script src="{{path}}/Tools/text.js" type="text/javascript"></script>
<script src="{{path}}/Tools/erase.js" type="text/javascript"></script>
<script src="{{path}}/Tools/image.js" type="text/javascript"></script>
<script src="{{path}}/Tools/pan.js" type="text/javascript"></script>

<script type="text/javascript">

    var isVsCode = !(typeof acquireVsCodeApi === 'undefined');
    var vscode = acquireVsCodeApi();
    var canvas = $("#canvas")[0];

    var app = new Reliable(canvas, [
        new Pen(),
        new Selection(),
        //new Eraser()
    ]);

   
    app.commit({"action":"Draw","id":"2ukA6dOUF5","path":"M 256.0 454.0C 256.0 454.0 256.0 453.0 256.0 453.0 256.0 451.0 256.0 449.0 256.0 446.0 257.0 444.0 258.0 440.0 260.0 437.0 261.0 434.0 263.0 430.0 265.0 426.0 267.0 423.0 270.0 419.0 272.0 415.0 276.0 411.0 279.0 407.0 284.0 404.0 289.0 399.0 292.0 396.0 296.0 393.0 301.0 391.0 305.0 389.0 308.0 388.0 312.0 387.0 313.0 387.0 318.0 387.0 321.0 387.0 325.0 387.0 327.0 387.0 330.0 388.0 333.0 389.0 336.0 391.0 339.0 393.0 342.0 395.0 345.0 397.0 348.0 400.0 351.0 403.0 354.0 406.0 357.0 408.0 360.0 412.0 363.0 415.0 366.0 418.0 369.0 422.0 372.0 426.0 375.0 429.0 378.0 433.0 380.0 436.0 383.0 440.0 386.0 443.0 388.0 446.0 390.0 448.0 392.0 450.0 394.0 452.0 396.0 455.0 397.0 456.0 399.0 458.0 401.0 459.0 403.0 462.0 405.0 463.0 408.0 464.0 411.0 465.0 414.0 466.0 417.0 467.0 422.0 467.0 426.0 468.0 431.0 468.0 436.0 468.0 442.0 468.0 448.0 468.0 453.0 468.0 458.0 467.0 460.0 467.0 463.0 465.0 466.0 464.0 470.0 462.0 473.0 460.0 475.0 457.0 477.0 454.0 480.0 450.0 482.0 446.0 483.0 444.0 486.0 441.0 487.0 438.0 489.0 435.0 490.0 433.0 491.0 431.0 492.0 429.0 493.0 428.0 494.0 425.0 494.0 423.0 495.0 420.0 495.0 417.0 496.0 416.0 496.0 413.0 497.0 410.0 497.0 407.0 497.0 405.0 497.0 402.0 497.0 401.0 497.0 399.0 497.0 397.0","color":"#AAB2C0","pos":{"x":256,"y":454}}, false);
    app.commit({"action":"Select","ids":["2ukA6dOUF5"]}, false);

    function undo(){
        app.undo();
    }

    function refresh(){
        console.clear();
        vscode.postMessage({
            action: "Refresh"
        });
    }

    function clearAll(){
        $(canvas).empty();
    }

    $("#toolName").text(app.getCurrentTool().name);
    //Events:

    //keypress events
    document.addEventListener('keydown', function(event) {
        if ((event.ctrlKey && event.key === 'z') || (event.metaKey && event.key === 'z')) {
            undo();
        }
        if(event.key === "p")app.currentTool ++;
        if(event.key === "o")app.currentTool --;
        if(app.currentTool==app.toolbar.length)app.currentTool=0;
        if(app.currentTool<0)app.currentTool=app.toolbar.length-1;
        $("#toolName").text(app.getCurrentTool().name);
    });

    //recieve message from VSCode
    window.addEventListener('message', (message) => {
        app.commit(message.data, false);
    });

    //Paste Image 
    document.onpaste = function(pasteEvent) {
        var item = pasteEvent.clipboardData.items[0];

        if (item.type.indexOf("image") === 0) {
            var blob = item.getAsFile();

            var reader = new FileReader();
            reader.onload = function(event) {
                //let img = new ImageSVG("path", new Vector2(), event.target.result);
                //svgs.push(img);
            };
            reader.readAsDataURL(blob);
        }
    }


    



</script>