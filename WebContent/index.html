<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Reliable</title>
        <style>
            img {
                -webkit-user-drag: none;
                -khtml-user-drag: none;
                -moz-user-drag: none;
                -o-user-drag: none;
            }
            g{
                z-index: 20;

            }

            .toolbar{
                position: absolute;
               
                left: 20px;
                top: 40px;
                
                background-color: #29303A;
                box-shadow: 2px 2px #20252C;
                line-height: 0px;
                border-radius: 5px;
                overflow: hidden;
            }

            .toolbar img{
                width: 40px;
                height: 40px;
                
            }

           


            .selected{
                pointer-events: none;
               
                background-color: #313743;
            }

            .unselected:hover{
                background-color: #404A58;
                cursor: pointer;
                
               
            }

            .iconDiv{
                padding: 10px;
            }

        </style>
    </head>
    <body>
          <!-- <path d="M 50 50 c 25 50, 75 -50, 100 0" fill="transparent" stroke="black"/>-->
       
        <svg preserveAspectRatio="xMidYMid meet" style="position: absolute; top:0px; left:0px; width:100%; height:100%; z-index: -1" id="canvas"> </svg>
       
        <!--img id="image" style="position:absolute;" src="https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif" width="300" /-->
        <!--div style = "left:200px;position: fixed; z-index: 10;">
            <h1>New Reliable: <i id="toolName" style="size:10">Pen<i/></h1>
            <button onClick="clearAll()">Clear</button>
            <button onClick="refresh()">Refresh</button>
            <button onClick="undo()">Undo</button>
        </div-->
        <div id="toolbar" class="toolbar">

            <!--
            <div class="iconDiv"><img src="{{path}}/images/icons/point2.svg"></div>
            <br>
            <div class="iconDiv"><img src="{{path}}/images/icons/pan2.svg"></div>
            <br>
            <div class="iconDiv"><img src="{{path}}/images/icons/draw2.svg"></div>
            <br>
            <div class="iconDiv"><img src="{{path}}/images/icons/erase2.svg"></div>
            <br>
            <div class="iconDiv"><img src="{{path}}/images/icons/image2.svg"></div>
            <br>
            <div class="iconDiv"><img src="{{path}}/images/icons/undo2.svg"></div>
            <br>
            <div class="iconDiv"><img src="{{path}}/images/icons/redo2.svg"></div>
           -->

        </div>
      
    </body>
</html>


<script src="{{path}}/jquery.js" type="text/javascript"></script>
<script src="{{path}}/Vector2.js" type="text/javascript"></script>
<script src="{{path}}/action.js" type="text/javascript"></script>
<script src="{{path}}/Svg/svg.js" type="text/javascript"></script>
<script src="{{path}}/Svg/svgPath.js" type="text/javascript"></script>
<script src="{{path}}/Svg/svgImage.js" type="text/javascript"></script>
<script src="{{path}}/Svg/svgPointer.js" type="text/javascript"></script>
<script src="{{path}}/tools/tools.js" type="text/javascript"></script>
<script src="{{path}}/reliable.js" type="text/javascript"></script>
<script src="{{path}}/Tools/pen.js" type="text/javascript"></script>
<script src="{{path}}/Tools/shape.js" type="text/javascript"></script>
<script src="{{path}}/Tools/selection.js" type="text/javascript"></script>
<script src="{{path}}/Tools/text.js" type="text/javascript"></script>
<script src="{{path}}/Tools/erase.js" type="text/javascript"></script>
<script src="{{path}}/Tools/image.js" type="text/javascript"></script>
<script src="{{path}}/Tools/pan.js" type="text/javascript"></script>

<script type="text/javascript">

    var isVsCode = !(typeof acquireVsCodeApi === 'undefined');
    var vscode = acquireVsCodeApi();
    var canvas = $("#canvas")[0];
    let mousePos = new Vector2();

    var app = new Reliable(canvas, "{{path}}", [
        new Pen(),
        new Selection(),
        new Eraser()
    ]);

  

    function undo(){
        app.undo();
    }

    function redo(){
        app.redo();
    }

    function refresh(){
        console.clear();
        vscode.postMessage({
            action: "Refresh"
        });
    }

    function clearAll(){
        $(canvas).empty();
    }

    $("#toolName").text(app.getCurrentTool().name);
    //Events:

    //keypress events
    document.addEventListener('keydown', (event)=> {
        if ((event.ctrlKey && event.key === 'z') || (event.metaKey && event.key === 'z')) {
            undo();
        }
        if((event.metaKey && event.key === 'y') || (event.ctrlKey && event.key === 'y')){
            redo();
        }
        if(event.key === 'r'){
            refresh();
        }
        if(event.key === 't'){
           app.test();
        }
        /*
        if(event.key === "p")app.currentTool ++;
        if(event.key === "o")app.currentTool --;
        if(app.currentTool==app.toolbar.length)app.currentTool=0;
        if(app.currentTool<0)app.currentTool=app.toolbar.length-1;*/
        //$("#toolName").text(app.getCurrentTool().name);
    });

    //recieve message from VSCode
    window.addEventListener('message', (message) => {
        app.commit(message.data, false);
    });

    //Paste Image 
    document.onpaste = function(pasteEvent) {
        var item = pasteEvent.clipboardData.items[0];

        if (item.type.indexOf("image") === 0) {
            var blob = item.getAsFile();

            var reader = new FileReader();
            reader.onload = function(event) {
                //let img = new ImageSVG("path", new Vector2(), event.target.result);
                //svgs.push(img);
                app.commit({
                    action: "Image",
                    id: Reliable.makeId(10),
                    image: event.target.result,
                    pos: {
                        x: mousePos.x,
                        y: mousePos.y,
                    }
                });   
            };
            reader.readAsDataURL(blob);
        }
    }

    canvas.addEventListener("mousemove", (e) => {
        
        mousePos.x = e.layerX;
        mousePos.y = e.layerY;
        //console.log(mousePos);
    });
    



</script>